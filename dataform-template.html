<!doctype html>
<html lang="en" class="h-100" data-bs-theme="light">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="generator" content="pandoc">
    <meta name="author" content="Ashkan Mirzaee">
    <meta name="description" content="A template for BQ Dataform
workflow">
    <title>Dataform template</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icon -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" integrity="sha384-tViUnnbYAV00FLIhhi3v/dWt3Jxw4gZQcNoSCxCIFNJVCx7/D55/wXsrNIRANwdD" crossorigin="anonymous">
    
    <!-- Highlight.js Styles -->
    <link rel="stylesheet" id="highlight-style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/stackoverflow-light.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="docs.css">
    <link rel="stylesheet" href="styles.css">
    
    <!-- After header contents -->
        <!-- Favicon -->
        <link rel="icon" href="images/AM.jpg">
        <!-- Google-site-verification -->
        <meta name="google-site-verification" content="lD_nifpQ-CA6LaDwxYJbe5bq0oa6Ir0Ax-txvtdP51E">
        <!-- Bing-site-verification -->
        <meta name="msvalidate.01" content="89BCD3FF42B6E9FE48E0C8365767D11B">
      </head>
  <body class="d-flex flex-column h-100" data-bs-spy="scroll" data-bs-target="#TableOfContents">
    <!-- Before body contents -->
        <nav class="navbar bd-navbar navbar-expand-lg fixed-top">
          <div class="container-xxl bd-gutter flex-wrap flex-lg-nowrap">
            <!-- Brand -->
            <a class="navbar-brand" href="index.html">Ashkan Mirzaee</a>
            
            <!-- Toggler -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <i class="bi bi-list fs-1"></i>
            </button>
            
            <!-- Navbar Content -->
            <div class="collapse navbar-collapse scrollable-navbar" id="navbarNav">
              <!-- Left Navigation -->
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                  <a class="nav-link" href="page1.html">Blog</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="tutorials.html">Tutorials</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="research.html">Research</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="applications.html">Applications</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="blogroll.html">Blogroll</a>
                </li>
              </ul>
              
              <!-- Divider for smaller screens -->
              <hr class="d-lg-none nav-line">
              
              <!-- Social Media Icons -->
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" href="contact.html" aria-label="Contact">
                    <i class="bi bi-envelope"></i>
        	    <span class="d-lg-none ms-2">Contact</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="https://github.com/ashki23" target="_blank" rel="noopener" aria-label="GitHub">
                    <i class="bi bi-github"></i>
        	    <span class="d-lg-none ms-2">GitHub</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="https://gitlab.com/ashki23" target="_blank" rel="noopener" aria-label="GitLab">
                    <i class="bi bi-gitlab"></i>
        	    <span class="d-lg-none ms-2">GitLab</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="https://www.linkedin.com/in/ashkan-mirzaee/" target="_blank" rel="noopener" aria-label="LinkedIn">
                    <i class="bi bi-linkedin"></i>
        	    <span class="d-lg-none ms-2">Linkedin</span>
                  </a>
                </li>
              </ul>
              
              <!-- Divider for larger screens -->
              <div class="vr d-none d-lg-flex mx-2 my-1 nav-line"></div>
              
              <!-- Divider for smaller screens -->
              <hr class="d-lg-none nav-line">
              
              <!-- Theme Dropdown -->
              <ul class="navbar-nav">
                <li class="nav-item dropdown">
                  <button class="btn btn-link nav-link dropdown-toggle" type="button" id="themeDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-circle-half"></i>
        	    <span class="d-lg-none ms-2">Toggle theme</span>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="themeDropdown">
                    <li>
                      <a class="dropdown-item align-items-center" data-theme="light">
                        <i class="bi bi-sun-fill me-2 opacity-50"></i> Light
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item align-items-center" data-theme="dark">
                        <i class="bi bi-moon-stars-fill me-2 opacity-50"></i> Dark
                      </a>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </nav>
        
    <div class="container-xxl bd-gutter bd-layout mb-5">
      <main class="bd-main order-1">
	
	<!-- Tiltle -->
	<h1 class="bd-intro ps-lg-2 pt-2" id="title">Dataform template</h1>
	
		<!-- Table of Contents -->
	<div class="bd-toc mt-lg-0 mb-lg-5 mt-3 mb-5 px-sm-1 text-body-secondary">
	  <strong class="d-md-block d-none h6 my-2 ms-3">On this page</strong>
	  <hr class="d-md-block d-none my-2 ms-3">
	  <div class="collapse bd-toc-collapse" id="tocContents">
	    <nav id="TableOfContents">
	      <ul>
      <li><a href="#the-template-repository-structure"
      id="toc-the-template-repository-structure">The template repository
      structure</a>
      <ul>
      <li><a href="#the-workflow-settings-file"
      id="toc-the-workflow-settings-file">The workflow settings
      file</a></li>
      <li><a href="#the-definitions-directory"
      id="toc-the-definitions-directory">The definitions
      directory</a></li>
      </ul></li>
      <li><a href="#sqlx-files" id="toc-sqlx-files">SQLX files</a>
      <ul>
      <li><a href="#sqlx-file-config-block"
      id="toc-sqlx-file-config-block">SQLX file config block</a></li>
      <li><a href="#sqlx-file-body" id="toc-sqlx-file-body">SQLX file
      body</a></li>
      </ul></li>
      </ul>
	    </nav>
	  </div>
	</div>
		
	<!-- Main Content -->
	<div class="bd-content ps-lg-2">
	  <p><a
  href="https://cloud.google.com/dataform/docs/overview">Dataform</a> is
  a service for data analysts to develop, test, control versions, and
  schedule complex workflows for data transformation in <a
  href="https://cloud.google.com/bigquery/docs/introduction">BigQuery</a>.
  Dataform lets us manage data transformation in the Extraction,
  Loading, and Transformation (ELT) process for data integration. After
  raw data is extracted from source systems and loaded into BigQuery,
  Dataform helps us to transform it into a well-defined, tested, and
  documented suite of data tables.</p>
  <p>Sources:</p>
  <ul>
  <li><a href="https://github.com/ashki23/dataform-template">Dataform
  template repository</a></li>
  <li><a
  href="https://cloud.google.com/dataform/docs/quickstart-create-workflow">Create
  and execute a SQL workflow in Dataform</a></li>
  <li><a
  href="https://cloud.google.com/dataform/docs/sql-workflows">Introduction
  to SQL workflows</a></li>
  <li><a
  href="https://cloud.google.com/dataform/docs/manage-repository#configure-workflow-settings">Configure
  Dataform workflow settings</a></li>
  <li><a
  href="https://cloud.google.com/dataform/docs/structure-repositories">Recommended
  structure of the definitions directory</a></li>
  <li><a
  href="https://cloud.google.com/dataform/docs/overview#sqlx_file_config_block">SQLX
  file config block</a></li>
  <li><a
  href="https://cloud.google.com/dataform/docs/overview#sqlx_file_body">SQLX
  file body</a></li>
  <li><a
  href="https://cloud.google.com/dataform/docs/connect-repository#github">Connect
  to a third-party Git repository</a></li>
  </ul>
  <hr />
  <h2 id="the-template-repository-structure">The template repository
  structure</h2>
  <p>The following shows the repository structure:</p>
  <div class="sourceCode" id="cb1"><pre
  class="sourceCode yml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="at">.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="at">├── README.md</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="at">├── definitions</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="at">│   ├── intermediate</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="at">│   ├── outputs</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="at">│   └── sources</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="at">└── workflow_settings.yaml</span></span></code></pre></div>
  <h3 id="the-workflow-settings-file">The workflow settings file</h3>
  <p>The <code>workflow_settings.yaml</code> file, introduced in
  Dataform core 3.0, stores Dataform workflow settings in the YAML
  format. The following code shows a sample
  <code>workflow_settings.yaml</code> file:</p>
  <div class="sourceCode" id="cb2"><pre
  class="sourceCode yml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">defaultProject</span><span class="kw">:</span><span class="at"> &lt;gcp-project-id&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">defaultDataset</span><span class="kw">:</span><span class="at"> &lt;dataset-name&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">defaultLocation</span><span class="kw">:</span><span class="at"> US</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">defaultAssertionDataset</span><span class="kw">:</span><span class="at"> dataform_assertions</span></span></code></pre></div>
  <p>In the preceding code sample, the key-value pairs are described as
  follows:</p>
  <ul>
  <li><code>defaultProject</code>: Your BigQuery Google Cloud project
  ID.</li>
  <li><code>defaultDataset</code>: The BigQuery dataset in which
  Dataform creates assets, called dataform by default.</li>
  <li><code>defaultLocation</code>: Your default BigQuery dataset
  region. In this location, Dataform processes your code and stores
  executed data. This processing region has to match the location of
  your BigQuery datasets, but it does not need to match the Dataform
  repository region.</li>
  <li><code>defaultAssertionDataset</code>: The BigQuery dataset in
  which Dataform creates views with assertion results, called
  dataform_assertions by default.</li>
  </ul>
  <h3 id="the-definitions-directory">The definitions directory</h3>
  <p>The following structure of subdirectories in the
  <code>definitions</code> directory reflects the key stages of a SQL
  workflow:</p>
  <ul>
  <li><code>sources</code>: Data source declarations and basic
  transformation of source data, for example, filtering.</li>
  <li><code>intermediate</code>: Tables and actions that read from
  sources and transform data before you use the transformed data to
  define outputs tables. Tables typically not exposed to additional
  processes or tools, such as business intelligence (BI) tools, after
  Dataform executes them to BigQuery.</li>
  <li><code>outputs</code>: Definitions of tables consumed by processes
  or tools, such as BI, after Dataform executes them in BigQuery.</li>
  <li><code>extra</code>: Files outside of the main pipeline of your SQL
  workflow, for example, files that contain workflow data prepared for
  additional use, like machine learning. An optional and custom
  subdirectory.</li>
  </ul>
  <p>The following example shows a subdirectory structure inside the
  <code>definitions</code> directory with filenames that conform to the
  recommended naming strategy:</p>
  <div class="sourceCode" id="cb3"><pre
  class="sourceCode yml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="at">definitions/</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="at">    sources/</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="at">        google_analytics.sqlx</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">        google_analytics_filtered.sqlx</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">    intermediate/</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="at">        stg_analytics_concept.sqlx</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="at">    outputs/</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="at">        customers.sqlx</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="at">        sales/</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="at">            sales.sqlx</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="at">            sales_revenue.sqlx</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="at">        ads/</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="at">            campaigns.sqlx</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="at">            ads_revenue.sqlx</span></span></code></pre></div>
  <h2 id="sqlx-files">SQLX files</h2>
  <p>To use Dataform core, we can write SQLX files. Each SQLX file
  contains a query that defines a database relation that Dataform
  creates and updates inside BigQuery.</p>
  <h3 id="sqlx-file-config-block">SQLX file config block</h3>
  <p>A SQLX file consists of a config block and a body. All config
  properties, and the config block itself, are optional. Given this, any
  plain SQL file is a valid SQLX file that Dataform executes as-is. We
  can use the cofing block for:</p>
  <ul>
  <li><p><a
  href="https://cloud.google.com/dataform/docs/declare-source">Data
  source declarations</a>, for example:</p>
  <div class="sourceCode" id="cb4"><pre
  class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>config {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">type</span>: <span class="ot">&quot;declaration&quot;</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">database</span>: <span class="ot">&quot;bigquery-public-data&quot;</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">schema</span>: <span class="ot">&quot;samples&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    name: <span class="ot">&quot;shakespeare&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
  <p>where:</p>
  <ul>
  <li><code>database</code>: the project ID of the project which
  contains the data source.</li>
  <li><code>schema</code>: the BigQuery dataset in which the data source
  exists.</li>
  <li><code>name</code>: the name of the table or view that you want to
  use as the data source. <strong>You can later use that name to
  reference the data source in Dataform</strong>.</li>
  </ul></li>
  <li><p><a
  href="https://cloud.google.com/dataform/docs/create-tables">Create
  tables</a>, for example:</p>
  <div class="sourceCode" id="cb5"><pre
  class="sourceCode sql"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>config {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">type</span>: <span class="ot">&quot;table&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
  <p>where:</p>
  <ul>
  <li><code>type</code>: specifies the table type, which can be one of
  the following: <code>table</code>, <code>view</code>, or
  <code>incremental</code>.</li>
  </ul></li>
  </ul>
  <h3 id="sqlx-file-body">SQLX file body</h3>
  <p>The SQLX body contains the SQL query used to create a table or
  perform other SQL operations in BigQuery. In the body we can use the
  <code>ref</code> function that lets us reference tables defined in the
  Dataform project instead of hard coding the schema and table names of
  the data table. For example:</p>
  <div class="sourceCode" id="cb6"><pre
  class="sourceCode sql"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>config { <span class="kw">type</span>: <span class="ot">&quot;table&quot;</span> }</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  order_date <span class="kw">AS</span> <span class="dt">date</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  order_id <span class="kw">AS</span> order_id,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  order_status <span class="kw">AS</span> order_status,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">SUM</span>(item_count) <span class="kw">AS</span> item_count,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">SUM</span>(amount) <span class="kw">AS</span> revenue</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> ${<span class="fu">ref</span>(<span class="ot">&quot;store_clean&quot;</span>)}</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span></span></code></pre></div>
	</div>
      </main>
    </div>
    
    <!-- After body contents -->
        <!-- Footer -->
        <footer class="footer bd-footer bg-body-tertiary mt-auto py-md-3 py-4">
          <div class="container text-body-secondary py-md-3 py-4" align="center">
            Content is licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">CC BY-SA 4.0</a>
            &nbsp;|&nbsp;
            Built by <a href="https://github.com/ashki23/pandoc-bootstrap" target="_blank" rel="noopener">pandoc-bootstrap</a> theme
            <br />
            Copyright 2018-2025, Ashkan Mirzaee
          </div>
        </footer>

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-132464297-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-132464297-1');
        </script>
        
    <!-- Bootstrap Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <!-- Highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js" integrity="sha512-6yoqbrcLAHDWAdQmiRlHG4+m0g/CT/V9AGyxabG8j7Jk8j3r3K6due7oqpiRMZqcYe9WM2gPcaNNxnl2ux+3tA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
        
    <!-- Custom Scripts -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
	  const htmlElement = document.documentElement;
	  const highlightStyle = document.getElementById("highlight-style");
	  
	  // Function to update Highlight.js style based on theme
	  const updateHighlightStyle = (theme) => {
              const lightTheme = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/stackoverflow-light.min.css";
              const darkTheme = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/github-dark.min.css";
              highlightStyle.href = theme === "dark" ? darkTheme : lightTheme;
	  };
	  
	  // Function to set the theme
	  const setTheme = (theme) => {
              htmlElement.setAttribute("data-bs-theme", theme);
              localStorage.setItem("theme", theme); // Save the theme to localStorage
              updateHighlightStyle(theme);
	  };
	  
	  // Get saved theme from localStorage or fallback to default ("light")
	  const savedTheme = localStorage.getItem("theme") || "light";
	  setTheme(savedTheme);
	  
	  // Event listener for theme dropdown
	  document.querySelectorAll(".dropdown-item").forEach((item) => {
              item.addEventListener("click", (e) => {
		  e.preventDefault();
		  const selectedTheme = item.getAttribute("data-theme");
		  setTheme(selectedTheme);
              });
	  });
	  
	  // Initialize Highlight.js
	  hljs.highlightAll();
      });
    </script>
  </body>
</html>

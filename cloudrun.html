<!doctype html>
<html lang="en" class="h-100" data-bs-theme="light">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="generator" content="pandoc">
    <meta name="author" content="Ashkan Mirzaee">
    <meta name="description" content="A GCP Cloud Run demo">
    <title>Cloud Run</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icon -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" integrity="sha384-tViUnnbYAV00FLIhhi3v/dWt3Jxw4gZQcNoSCxCIFNJVCx7/D55/wXsrNIRANwdD" crossorigin="anonymous">
    
    <!-- Highlight.js Styles -->
    <link rel="stylesheet" id="highlight-style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/stackoverflow-light.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="docs.css">
    <link rel="stylesheet" href="styles.css">
    
    <!-- After header contents -->
        <!-- Favicon -->
        <link rel="icon" href="images/AM.jpg">
        <!-- Google-site-verification -->
        <meta name="google-site-verification" content="lD_nifpQ-CA6LaDwxYJbe5bq0oa6Ir0Ax-txvtdP51E">
        <!-- Bing-site-verification -->
        <meta name="msvalidate.01" content="89BCD3FF42B6E9FE48E0C8365767D11B">
      </head>
  <body class="d-flex flex-column h-100" data-bs-spy="scroll" data-bs-target="#TableOfContents">
    <!-- Before body contents -->
        <nav class="navbar bd-navbar navbar-expand-lg fixed-top">
          <div class="container-xxl bd-gutter flex-wrap flex-lg-nowrap">
            <!-- Brand -->
            <a class="navbar-brand" href="index.html">Ashkan Mirzaee</a>
            
            <!-- Toggler -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <i class="bi bi-list fs-1"></i>
            </button>
            
            <!-- Navbar Content -->
            <div class="collapse navbar-collapse scrollable-navbar" id="navbarNav">
              <!-- Left Navigation -->
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                  <a class="nav-link" href="page1.html">Blog</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="tutorials.html">Tutorials</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="research.html">Research</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="applications.html">Applications</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="blogroll.html">Blogroll</a>
                </li>
              </ul>
              
              <!-- Divider for smaller screens -->
              <hr class="d-lg-none nav-line">
              
              <!-- Social Media Icons -->
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" href="contact.html" aria-label="Contact">
                    <i class="bi bi-envelope"></i>
        	    <span class="d-lg-none ms-2">Contact</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="https://github.com/ashki23" target="_blank" rel="noopener" aria-label="GitHub">
                    <i class="bi bi-github"></i>
        	    <span class="d-lg-none ms-2">GitHub</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="https://gitlab.com/ashki23" target="_blank" rel="noopener" aria-label="GitLab">
                    <i class="bi bi-gitlab"></i>
        	    <span class="d-lg-none ms-2">GitLab</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="https://www.linkedin.com/in/ashkan-mirzaee/" target="_blank" rel="noopener" aria-label="LinkedIn">
                    <i class="bi bi-linkedin"></i>
        	    <span class="d-lg-none ms-2">Linkedin</span>
                  </a>
                </li>
              </ul>
              
              <!-- Divider for larger screens -->
              <div class="vr d-none d-lg-flex mx-2 my-1 nav-line"></div>
              
              <!-- Divider for smaller screens -->
              <hr class="d-lg-none nav-line">
              
              <!-- Theme Dropdown -->
              <ul class="navbar-nav">
                <li class="nav-item dropdown">
                  <button class="btn btn-link nav-link dropdown-toggle" type="button" id="themeDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-circle-half"></i>
        	    <span class="d-lg-none ms-2">Toggle theme</span>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="themeDropdown">
                    <li>
                      <a class="dropdown-item align-items-center" data-theme="light">
                        <i class="bi bi-sun-fill me-2 opacity-50"></i> Light
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item align-items-center" data-theme="dark">
                        <i class="bi bi-moon-stars-fill me-2 opacity-50"></i> Dark
                      </a>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </nav>
        
    <div class="container-xxl bd-gutter bd-layout mb-5">
      <main class="bd-main order-1">
	
	<!-- Tiltle -->
	<h1 class="bd-intro ps-lg-2 pt-2" id="title">Cloud Run</h1>
	
		<!-- Table of Contents -->
	<div class="bd-toc mt-lg-0 mb-lg-5 mt-3 mb-5 px-sm-1 text-body-secondary">
	  <strong class="d-md-block d-none h6 my-2 ms-3">On this page</strong>
	  <hr class="d-md-block d-none my-2 ms-3">
	  <div class="collapse bd-toc-collapse" id="tocContents">
	    <nav id="TableOfContents">
	      <ul>
      <li><a href="#requirements"
      id="toc-requirements">Requirements</a></li>
      <li><a href="#build-the-container-and-push-it-to-gcp"
      id="toc-build-the-container-and-push-it-to-gcp">Build the
      Container and push it to GCP</a></li>
      <li><a href="#running-a-cloud-run-job"
      id="toc-running-a-cloud-run-job">Running a Cloud Run job</a></li>
      <li><a href="#scheduling-jobs" id="toc-scheduling-jobs">Scheduling
      jobs</a></li>
      <li><a href="#managing-secrets" id="toc-managing-secrets">Managing
      secrets</a></li>
      <li><a href="#clean-up" id="toc-clean-up">Clean up</a></li>
      </ul>
	    </nav>
	  </div>
	</div>
		
	<!-- Main Content -->
	<div class="bd-content ps-lg-2">
	  <p><a
  href="https://cloud.google.com/run/docs/overview/what-is-cloud-run">Cloud
  Run</a> is a managed compute platform that lets you run containers
  directly on top of Google’s scalable infrastructure. You can deploy
  code written in any programming language on Cloud Run if you can build
  a container image from it. In short, Cloud Run allows developers to
  spend their time writing their code, and very little time operating,
  configuring, and scaling their Cloud Run service. You don’t have to
  create a cluster or manage infrastructure in order to be productive
  with Cloud Run.</p>
  <p>In this tutorial, you will learn how to schedule a job to execute a
  Python script on GCP (similar to scheduling queries in BigQuery):</p>
  <ul>
  <li>Required files:
  <ul>
  <li><code>main.py</code>: a Python application</li>
  <li><code>requirements.txt</code>: a recipe to create the Python
  environment</li>
  <li><code>Containerfile</code>: a recipe to create a container</li>
  </ul></li>
  <li>Tools:
  <ul>
  <li><code>podman</code>: to create a container of the Python script
  and its dependencies</li>
  <li><code>gcloud</code>: to interact with Google Cloud Platform</li>
  </ul></li>
  </ul>
  <p>Sources:</p>
  <ul>
  <li><a
  href="https://cloud.google.com/run/docs/overview/what-is-cloud-run">What
  is Cloud Run</a></li>
  <li><a
  href="https://cloud.google.com/run/docs/create-jobs#gcloud">Creat
  jobs</a></li>
  <li><a
  href="https://cloud.google.com/run/docs/execute/jobs-on-schedule#command-line">Execute
  jobs on a schedule</a></li>
  <li><a
  href="https://cloud.google.com/scheduler/docs/configuring/cron-job-schedules">Cron
  job format and time zone</a></li>
  <li><a
  href="https://cloud.google.com/run/docs/configuring/jobs/secrets#gcloud">Configure
  secrets</a></li>
  <li><a
  href="https://cloud.google.com/run/docs/quickstarts/build-and-deploy/deploy-python-service">Quickstart:
  Build and deploy a Python web app to Cloud Run</a></li>
  <li><a href="https://podman.io/docs">Getting Started with
  Podman</a></li>
  </ul>
  <hr />
  <h2 id="requirements">Requirements</h2>
  <p>To create a container, you need a <code>Containerfile</code>. You
  can generate one using the Nano text editor by running:</p>
  <div class="sourceCode" id="cb1"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a new directory</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> cloud-run-demo</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Go to the new directory</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> cloud-run-demo</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a Containerfile</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> Containerfile</span></code></pre></div>
  <p>Next, copy the following into the <code>Containerfile</code> (this
  is just an example; feel free to customize it as needed):</p>
  <pre class="containerfile"><code># Use Python slim image from Docker Hub
FROM python:3.13.2-slim

# Set the working directory within the container
WORKDIR /app

# Copy requirements.txt first for efficient caching
COPY requirements.txt .

# Install dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Copy the application code
COPY main.py .

# Set the entrypoint for the container (the command that runs when the container starts)
CMD [&quot;python&quot;, &quot;main.py&quot;]</code></pre>
  <p>Press <code>Ctrl + X</code>, then <code>Y</code>, then
  <code>Enter</code> to write the file and exit.</p>
  <p>We also need a <code>requirements.txt</code> file to list the
  required packages. Use the nano text editor to create it:</p>
  <div class="sourceCode" id="cb3"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> requirements.txt</span></code></pre></div>
  <p>Copy the following into the <code>requirements.txt</code> file
  (this is just an example; be sure to list the specific dependencies
  for your Python application):</p>
  <div class="sourceCode" id="cb4"><pre
  class="sourceCode txt"><code class="sourceCode default"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>pandas</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>pandas-gbq</span></code></pre></div>
  <p>Press <code>Ctrl + X</code>, then <code>Y</code>, then
  <code>Enter</code> to write the file and exit.</p>
  <p>Finally, we need to add our Python code. As an example, create a
  <code>main.py</code> file using nano by running
  <code>nano main.py</code>, then copy the following code into the
  file:</p>
  <div class="sourceCode" id="cb5"><pre
  class="sourceCode py"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.cloud <span class="im">import</span> bigquery</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas_gbq</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> bigquery.Client()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT * FROM bigquery-public-data.ml_datasets.penguins</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE  body_mass_g &lt; 3500 AND sex = &#39;FEMALE&#39;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> client.query(sql).to_dataframe()</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>df.to_gbq(<span class="st">&#39;BQ_Tutorial.penguins_data&#39;</span>, if_exists<span class="op">=</span><span class="st">&#39;replace&#39;</span>)</span></code></pre></div>
  <p>Press <code>Ctrl + X</code>, then <code>Y</code>, then
  <code>Enter</code> to write the file and exit.</p>
  <h2 id="build-the-container-and-push-it-to-gcp">Build the Container
  and push it to GCP</h2>
  <p>First, locate the destination for your container in <a
  href="https://console.cloud.google.com/artifacts">GCP Artifact
  Registry</a> and copy the repository path:</p>
  <p align="center">
  <img src="images/gcp-artifact-registery.png" alt="GCP Artifact Registry" style="width: 90%; border: 0;">
  </p>
  <p>The path should be like:
  <code>&lt;region&gt;-docker.pkg.dev/&lt;project-id&gt;/&lt;images-directory&gt;</code>.</p>
  <p>To build the container using <code>podman</code>, execute the
  following command:</p>
  <div class="sourceCode" id="cb6"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">podman</span> build <span class="at">-t</span> <span class="op">&lt;</span>container-path<span class="op">&gt;</span>/<span class="op">&lt;</span>app-name<span class="op">&gt;</span>:<span class="op">&lt;</span>tag<span class="op">&gt;</span> .</span></code></pre></div>
  <p>The <code>app-name</code> must use only lowercase alphanumeric
  characters and dashes, cannot begin or end with a dash, and cannot be
  longer than 63 characters. For instance, for my project ID, path, and
  app ID the command will look like this:</p>
  <div class="sourceCode" id="cb7"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">podman</span> build <span class="at">-t</span> us-central1-docker.pkg.dev/proj-58536f721/container-images/pandas-app:1.0-demo .</span></code></pre></div>
  <p>Before pushing the container to GCP Artifact Registry, you need to
  log in to your GCP account. Run the following command to
  authenticate:</p>
  <div class="sourceCode" id="cb8"><pre
  class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> auth login</span></code></pre></div>
  <p>Then, configure authentication for the Artifact Registry:</p>
  <div class="sourceCode" id="cb9"><pre
  class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> auth configure-docker <span class="op">&lt;</span>region<span class="op">&gt;</span>-docker.pkg.dev</span></code></pre></div>
  <p>Replace <code>&lt;region&gt;</code> with your GCP region (e.g.,
  <code>us-central1</code>).</p>
  <p>Now, use <code>podman</code> to push the container to GCP Artifact
  Registry by running the following command:</p>
  <div class="sourceCode" id="cb10"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">podman</span> push <span class="op">&lt;</span>container-path<span class="op">&gt;</span>/<span class="op">&lt;</span>app-name<span class="op">&gt;</span>:<span class="op">&lt;</span>tag<span class="op">&gt;</span></span></code></pre></div>
  <p>Replace
  <code>&lt;container-path&gt;/&lt;app-name&gt;:&lt;tag&gt;</code> with
  the actual image path, name, and tag, which will look something
  like:</p>
  <div class="sourceCode" id="cb11"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">podman</span> push us-central1-docker.pkg.dev/proj-58536f721/container-images/pandas-app:1.0-demo</span></code></pre></div>
  <h2 id="running-a-cloud-run-job">Running a Cloud Run job</h2>
  <p>To run the Cloud Run job, first set the project ID and then execute
  the following command:</p>
  <div class="sourceCode" id="cb12"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set project ID</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> config set project <span class="op">&lt;</span>project-id<span class="op">&gt;</span></span></code></pre></div>
  <p>After setting the project ID, run the Cloud Run job using:</p>
  <div class="sourceCode" id="cb13"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the job</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> run jobs create <span class="op">&lt;</span>job-name<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">--image</span> <span class="op">&lt;</span>container-path<span class="op">&gt;</span>/<span class="op">&lt;</span>app-name<span class="op">&gt;</span>:<span class="op">&lt;</span>tag<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">--region</span> <span class="op">&lt;</span>region<span class="op">&gt;</span></span></code></pre></div>
  <p>Some other options that can be added are:</p>
  <div class="sourceCode" id="cb14"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">--cup</span> <span class="co"># set number of cpus (default 1)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">--memory</span> <span class="co"># set memory limit. Ex: 2G, 256M (default 512M)</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">--max-retries</span> <span class="co"># Number of times a task is allowed to restart in case of failure (default 3) </span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="ex">--service-aacount</span> <span class="co"># Specify the service account associated with the service</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="ex">--set-env-vars</span> <span class="co"># List of key-value pairs to set as environment variables. Ex: --set-env-vars ENV=myenv,OTHER_ENV=otherenv</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="ex">--env-vars-file</span> <span class="co"># Path to a local YAML file with definitions for all environment variables. Example YAML content: KEY_1: &quot;value1&quot;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="ex">--set-secrets</span> <span class="co"># Specify secrets to provide as environment variables. Ex: --set-secrets ENV=mysecret:latest,OTHER_ENV=othersecret:1</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="ex">--vpc-connector</span> <span class="co"># Set a VPC connector for this resource</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="ex">--vpc-egress</span> all-traffic <span class="co"># Sends all outbound traffic through Direct VPC egress or the VPC connector</span></span></code></pre></div>
  <p>For a full list of available options when creating a job, refer to
  the <a
  href="https://cloud.google.com/sdk/gcloud/reference/run/jobs/create">gcloud
  run jobs create</a> command line documentation. After creating the
  job, we can execute it by:</p>
  <div class="sourceCode" id="cb15"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> run jobs execute <span class="op">&lt;</span>job-name<span class="op">&gt;</span> --region <span class="op">&lt;</span>region<span class="op">&gt;</span></span></code></pre></div>
  <p>Note that the <code>job-name</code> must use only lowercase
  alphanumeric characters and dashes, cannot begin or end with a dash,
  and cannot be longer than 63 characters. For instance:</p>
  <div class="sourceCode" id="cb16"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> run jobs create cloud-run-demo <span class="dt">\</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">--image</span> us-central1-docker.pkg.dev/proj-58536f721/container-images/pandas-app:1.0-demo <span class="dt">\</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">--region</span> us-central1</span></code></pre></div>
  <p>And execute it by:</p>
  <div class="sourceCode" id="cb17"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> run jobs execute cloud-run-demo <span class="at">--region</span> us-central1</span></code></pre></div>
  <h2 id="scheduling-jobs">Scheduling jobs</h2>
  <p>To execute a Cloud Run job on a schedule, you can use Cloud
  Scheduler. Here’s the command to set up a scheduled job:</p>
  <div class="sourceCode" id="cb18"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> scheduler jobs create http <span class="op">&lt;</span>scheduler-job-name<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--location</span> <span class="op">&lt;</span>region<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--schedule</span> <span class="op">&lt;</span>cron-format<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">--uri</span> <span class="st">&quot;https://&lt;region&gt;-run.googleapis.com/apis/run.googleapis.com/v1/namespaces/&lt;project-id&gt;/jobs/&lt;job-name&gt;:run&quot;</span> <span class="dt">\</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">--http-method</span> POST <span class="dt">\</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">--oauth-service-account-email</span> <span class="op">&lt;</span>service-account<span class="op">&gt;</span>@<span class="op">&lt;</span>project-id<span class="op">&gt;</span>.iam.gserviceaccount.com</span></code></pre></div>
  <p>To update a previously scheduled job, we can run:</p>
  <div class="sourceCode" id="cb19"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> scheduler jobs update http <span class="op">&lt;</span>scheduler-job-name<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--location</span> <span class="op">&lt;</span>region<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--schedule</span> <span class="op">&lt;</span>new-schedule<span class="op">&gt;</span> <span class="dt">\</span></span></code></pre></div>
  <p>And to list all the scheduled jobs in the project, run:</p>
  <div class="sourceCode" id="cb20"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> scheduler jobs list <span class="at">--location</span> <span class="op">&lt;</span>region<span class="op">&gt;</span></span></code></pre></div>
  <p>For instance, to execute the cloud-run-demo job every Monday at
  noon UTC (<code>0 12 * * 1</code>):</p>
  <div class="sourceCode" id="cb21"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> scheduler jobs create http scheduled-cloud-run-demo <span class="dt">\</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--location</span> us-central1 <span class="dt">\</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--schedule</span> <span class="st">&quot;0 12 * * 1&quot;</span> <span class="dt">\</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">--uri</span> <span class="st">&quot;https://us-central1-run.googleapis.com/apis/run.googleapis.com/v1/namespaces/proj-58536f721/jobs/cloud-run-demo:run&quot;</span> <span class="dt">\</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">--http-method</span> POST</span></code></pre></div>
  <p>After creating the Cloud Scheduler job, you can verify its
  configuration and see when it’s next scheduled to run using the
  following command:</p>
  <div class="sourceCode" id="cb22"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> scheduler jobs describe scheduled-cloud-run-demo <span class="at">--location</span> us-central1</span></code></pre></div>
  <h2 id="managing-secrets">Managing secrets</h2>
  <p>📙 <strong>Important note:</strong> Never hard-code your
  credentials and secrets in your code, and avoid committing them to
  version control or including them in containers.</p>
  <p>The best practice for managing credentials in GCP is to store them
  in the Secret Manager and pass them to the container as environment
  variables. To create a secret, run:</p>
  <div class="sourceCode" id="cb23"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> secrets create <span class="op">&lt;</span>secret-name<span class="op">&gt;</span> --replication-policy <span class="st">&quot;automatic&quot;</span></span></code></pre></div>
  <p>To add the a secret to it, run:</p>
  <div class="sourceCode" id="cb24"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> secrets versions add <span class="op">&lt;</span>secret-name<span class="op">&gt;</span> --data-file /path/to/secret/file</span></code></pre></div>
  <p>For instance:</p>
  <div class="sourceCode" id="cb25"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To create the secret</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> secrets create cloud-run-demo-secret <span class="at">--replication-policy</span> <span class="st">&quot;automatic&quot;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a secret</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> secrets versions add cloud-run-demo-secret <span class="at">--data-file</span> demo-secret.txt</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># List secrets</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> secrets list</span></code></pre></div>
  <p>We can provide credentials to the Cloud Run job by using the
  <code>--set-secrets DEMO_SC=cloud-run-demo-secret:latest</code> option
  when creating the job.</p>
  <h2 id="clean-up">Clean up</h2>
  <p>To remove the demo container image from the Artifact Registry, you
  can run:</p>
  <div class="sourceCode" id="cb26"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> container images delete <span class="op">&lt;</span>container-path<span class="op">&gt;</span>/<span class="op">&lt;</span>app-name<span class="op">&gt;</span>:<span class="op">&lt;</span>tag<span class="op">&gt;</span></span></code></pre></div>
  <p>To remove the Cloud Run job, run:</p>
  <div class="sourceCode" id="cb27"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> run jobs delete <span class="op">&lt;</span>job-name<span class="op">&gt;</span> --region <span class="op">&lt;</span>region<span class="op">&gt;</span></span></code></pre></div>
  <p>To remove the scheduler, run:</p>
  <div class="sourceCode" id="cb28"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> scheduler jobs delete <span class="op">&lt;</span>scheduler-job-name<span class="op">&gt;</span> --location <span class="op">&lt;</span>region<span class="op">&gt;</span></span></code></pre></div>
  <p>And to remove the secret, run:</p>
  <div class="sourceCode" id="cb29"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> secrets delete <span class="op">&lt;</span>secret-name<span class="op">&gt;</span></span></code></pre></div>
  <p>For instance:</p>
  <div class="sourceCode" id="cb30"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Delete the image</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> container images delete us-central1-docker.pkg.dev/proj-58536f721/container-images/pandas-app:1.0-demo</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Delete the job</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> run jobs delete cloud-run-demo <span class="at">--region</span> us-central1</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Delete the scheduler</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> scheduler jobs delete scheduled-cloud-run-demo <span class="at">--location</span> us-central1</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Delete the secret</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> secrets delete cloud-run-demo-secret</span></code></pre></div>
	</div>
      </main>
    </div>
    
    <!-- After body contents -->
        <!-- Footer -->
        <footer class="footer bd-footer bg-body-tertiary mt-auto py-md-3 py-4">
          <div class="container text-body-secondary py-md-3 py-4" align="center">
            Content is licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">CC BY-SA 4.0</a>
            &nbsp;|&nbsp;
            Built by <a href="https://github.com/ashki23/pandoc-bootstrap" target="_blank" rel="noopener">pandoc-bootstrap</a> theme
            <br />
            Copyright 2018-2025, Ashkan Mirzaee
          </div>
        </footer>

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-132464297-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-132464297-1');
        </script>
        
    <!-- Bootstrap Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <!-- Highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js" integrity="sha512-6yoqbrcLAHDWAdQmiRlHG4+m0g/CT/V9AGyxabG8j7Jk8j3r3K6due7oqpiRMZqcYe9WM2gPcaNNxnl2ux+3tA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
        
    <!-- Custom Scripts -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
	  const htmlElement = document.documentElement;
	  const highlightStyle = document.getElementById("highlight-style");
	  
	  // Function to update Highlight.js style based on theme
	  const updateHighlightStyle = (theme) => {
              const lightTheme = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/stackoverflow-light.min.css";
              const darkTheme = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/github-dark.min.css";
              highlightStyle.href = theme === "dark" ? darkTheme : lightTheme;
	  };
	  
	  // Function to set the theme
	  const setTheme = (theme) => {
              htmlElement.setAttribute("data-bs-theme", theme);
              localStorage.setItem("theme", theme); // Save the theme to localStorage
              updateHighlightStyle(theme);
	  };
	  
	  // Get saved theme from localStorage or fallback to default ("light")
	  const savedTheme = localStorage.getItem("theme") || "light";
	  setTheme(savedTheme);
	  
	  // Event listener for theme dropdown
	  document.querySelectorAll(".dropdown-item").forEach((item) => {
              item.addEventListener("click", (e) => {
		  e.preventDefault();
		  const selectedTheme = item.getAttribute("data-theme");
		  setTheme(selectedTheme);
              });
	  });
	  
	  // Initialize Highlight.js
	  hljs.highlightAll();
      });
    </script>
  </body>
</html>

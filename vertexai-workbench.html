<!doctype html>
<html lang="en" class="h-100" data-bs-theme="light">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="generator" content="pandoc">
    <meta name="author" content="Ashkan Mirzaee">
    <meta name="description" content="An introduction to use Vertex AI
workbenchs">
    <title>Vertex AI: workbench</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icon -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" integrity="sha384-tViUnnbYAV00FLIhhi3v/dWt3Jxw4gZQcNoSCxCIFNJVCx7/D55/wXsrNIRANwdD" crossorigin="anonymous">
    
    <!-- Highlight.js Styles -->
    <link rel="stylesheet" id="highlight-style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/stackoverflow-light.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="https://getbootstrap.com/docs/5.3/assets/css/docs.css">
    <link rel="stylesheet" href="styles.css">
    
    <!-- After header contents -->
        <!-- Favicon -->
        <link rel="icon" href="images/AM.jpg">
        <!-- Google-site-verification -->
        <meta name="google-site-verification" content="lD_nifpQ-CA6LaDwxYJbe5bq0oa6Ir0Ax-txvtdP51E">
        <!-- Bing-site-verification -->
        <meta name="msvalidate.01" content="89BCD3FF42B6E9FE48E0C8365767D11B">
      </head>
  <body class="d-flex flex-column h-100" data-bs-spy="scroll" data-bs-target="#TableOfContents">
    <!-- Before body contents -->
        <nav class="navbar bd-navbar navbar-expand-lg fixed-top py-2">
          <div class="container-xxl bd-gutter flex-wrap flex-lg-nowrap">
            <!-- Brand -->
            <a class="navbar-brand" href="index.html" style="transform: none;">Ashkan Mirzaee</a>
            
            <!-- Toggler -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            
            <!-- Navbar Content -->
            <div class="collapse navbar-collapse navbar-nav-scroll" id="navbarNav">
              <!-- Left Navigation -->
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                  <a class="nav-link" href="page1.html">Blog</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="tutorials.html">Tutorials</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="research.html">Research</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="applications.html">Applications</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="blogroll.html">Blogroll</a>
                </li>
              </ul>
              
              <!-- Divider for smaller screens -->
              <hr class="d-lg-none text-white-50">
              
              <!-- Social Media Icons -->
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" href="contact.html" aria-label="Contact">
                    <i class="bi bi-envelope"></i>
        	    <span class="d-lg-none ms-2">Contact</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="https://github.com/ashki23" target="_blank" rel="noopener" aria-label="GitHub">
                    <i class="bi bi-github"></i>
        	    <span class="d-lg-none ms-2">GitHub</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="https://gitlab.com/ashki23" target="_blank" rel="noopener" aria-label="GitLab">
                    <i class="bi bi-gitlab"></i>
        	    <span class="d-lg-none ms-2">GitLab</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="https://www.linkedin.com/in/ashkan-mirzaee/" target="_blank" rel="noopener" aria-label="LinkedIn">
                    <i class="bi bi-linkedin"></i>
        	    <span class="d-lg-none ms-2">Linkedin</span>
                  </a>
                </li>
              </ul>
              
              <!-- Divider for larger screens -->
              <div class="vr d-none d-lg-flex mx-2 my-1 text-white"></div>
              
              <!-- Divider for smaller screens -->
              <hr class="d-lg-none text-white-50">
              
              <!-- Theme Dropdown -->
              <ul class="navbar-nav">
                <li class="nav-item dropdown">
                  <button class="btn btn-link nav-link dropdown-toggle" type="button" id="themeDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-circle-half"></i>
        	    <span class="d-lg-none ms-2">Toggle theme</span>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="themeDropdown">
                    <li>
                      <a class="dropdown-item align-items-center" data-theme="light">
                        <i class="bi bi-sun-fill me-2 opacity-50"></i> Light
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item align-items-center" data-theme="dark">
                        <i class="bi bi-moon-stars-fill me-2 opacity-50"></i> Dark
                      </a>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </nav>
        
    <div class="container-xxl bd-gutter pb-5 mt-3 my-md-4 bd-layout" style="padding-top:60px;">
      <main class="bd-main order-1">
	
	<!-- Tiltle -->
	<h1 class="bd-intro pt-2 ps-lg-2" id="title">Vertex AI: workbench</h1>
	
		<!-- Table of Contents -->
	<div class="bd-toc mt-3 mb-5 my-lg-0 mb-lg-5 px-sm-1 text-body-secondary">
	  <strong class="d-none d-md-block h6 my-2 ms-3">On this page</strong>
	  <hr class="d-none d-md-block my-2 ms-3">
	  <div class="collapse bd-toc-collapse" id="tocContents">
	    <nav id="TableOfContents">
	      <ul>
      <li><a href="#create-a-workbench-from-gcp-console"
      id="toc-create-a-workbench-from-gcp-console">Create a workbench
      from GCP console</a></li>
      <li><a href="#using-the-gcp-instance-from-jupyter-lab"
      id="toc-using-the-gcp-instance-from-jupyter-lab">Using the GCP
      instance from Jupyter-Lab</a>
      <ul>
      <li><a href="#install-new-packages-or-tools"
      id="toc-install-new-packages-or-tools">Install new packages or
      tools</a></li>
      <li><a href="#bigquery" id="toc-bigquery">BigQuery</a></li>
      </ul></li>
      <li><a href="#use-the-gpc-instance-from-a-local-terminal"
      id="toc-use-the-gpc-instance-from-a-local-terminal">Use the GPC
      instance from a local terminal</a></li>
      </ul>
	    </nav>
	  </div>
	</div>
		
	<!-- Main Content -->
	<div class="bd-content ps-lg-2">
	  <p>Vertex AI is a GCP platform for machine learning (ML) that lets
  users to store ML models, features, and training sets and for running
  their ML applications. This can be particularly useful for projects
  that are fully developed and can be reconfigured for Vertex AI
  platform. Vertex AI also provides a workbench environment for testing
  and developing new projects. Here, we discuss how to apply compute
  engines from Vertex AI to run our workflows on GCP.</p>
  <hr />
  <h2 id="create-a-workbench-from-gcp-console">Create a workbench from
  GCP console</h2>
  <ul>
  <li>From Vertex AI select Workbench</li>
  <li>Select “USER-MANAGED NOTEBOOKS” and press “+ NEW NOTEBOOK”</li>
  <li>Select Python 3 and click “ADVANCED OPTIONS” and set the following
  options and press “CREATE”:
  <ul>
  <li>Notebook name: select a name</li>
  <li>Region: <code>us-central1 (Iowa)</code> and Zone:
  <code>us-central1-a</code></li>
  </ul></li>
  <li>Machine configuration
  <ul>
  <li>Machin type: select resources that you need</li>
  </ul></li>
  <li>Networking:
  <ul>
  <li>Select the shared network if available (if any)</li>
  </ul></li>
  <li>Permission:
  <ul>
  <li>If you create the workbench only for yourself then, Select “Single
  user only”. Note that if you select this option other member of your
  group will not be able to use this workbench</li>
  <li>Use any service account that is available (if any)</li>
  </ul></li>
  </ul>
  <p><strong>Important Note:</strong> after the instance is created it
  will cost your team as long as it is running, no matter if it is using
  or not. If you do not use the instance simply <strong>stop</strong>
  the instance and <strong>start</strong> it when you need the resources
  again.</p>
  <h2 id="using-the-gcp-instance-from-jupyter-lab">Using the GCP
  instance from Jupyter-Lab</h2>
  <p>After creating an instance (or start an existing one), click “OPEN
  JUPYTERLAB” to start the Jupyter Server on the browser. To open a
  Notebook, click Python 3 kernel under the Notebook.</p>
  <h3 id="install-new-packages-or-tools">Install new packages or
  tools</h3>
  <p>We can install new Python packages form Notebook by using
  <code>pip</code>:</p>
  <div class="sourceCode" id="cb1"><pre
  class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Python packages via pip</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">!pip</span> install <span class="op">&lt;</span>package-name<span class="op">&gt;</span></span></code></pre></div>
  <p>For instance:</p>
  <div class="sourceCode" id="cb2"><pre
  class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install pandas-qbq</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">!pip</span> install pandas-gbq</span></code></pre></div>
  <p>For installing a list of packages (<code>requirements.txt</code>),
  then we can run:</p>
  <div class="sourceCode" id="cb3"><pre
  class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Python packages via pip from req. file</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">!pip</span> install <span class="at">-r</span> requirements.txt</span></code></pre></div>
  <p>If you need to pass a proxy, you can use:</p>
  <div class="sourceCode" id="cb4"><pre
  class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Python packages with a proxy</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">!pip</span> install <span class="at">--proxy</span> <span class="op">&lt;</span>proxy:port<span class="op">&gt;</span> <span class="op">&lt;</span>package-name<span class="op">&gt;</span> </span></code></pre></div>
  <p>Beside Python packages, users have <code>sudo</code> privilege to
  install/update Unix tools. For instance, to update current tools
  run:</p>
  <div class="sourceCode" id="cb5"><pre
  class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Unix tools</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> <span class="at">-E</span> apt upgrade <span class="at">-y</span></span></code></pre></div>
  <p>If need a proxy, we can run:</p>
  <div class="sourceCode" id="cb6"><pre
  class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Unix tools</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">!export</span> http_proxy=<span class="op">&lt;</span>proxt:port<span class="op">&gt;</span> <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> <span class="at">-E</span> apt update <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> <span class="at">-E</span> apt upgrade <span class="at">-y</span></span></code></pre></div>
  <p>For an example let’s install Java and add PySpark package:</p>
  <div class="sourceCode" id="cb7"><pre
  class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install PySpark</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">sudoapt</span> install <span class="at">-y</span> default-jre</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">!pip</span> install pyspark</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">import</span> pyspark</span></code></pre></div>
  <h3 id="bigquery">BigQuery</h3>
  <p>From the Jupyter Notebook users can apply <code>google.cloud</code>
  package to communicate with public or private datasets in BigQuery.
  For instance, run the following to count rows in <code>penguins</code>
  table from a public data:</p>
  <div class="sourceCode" id="cb8"><pre
  class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># BigQuery from a public data</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.cloud <span class="im">import</span> bigquery</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> bigquery.Client()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">&quot;SELECT COUNT(*) AS COUNT FROM bigquery-public-data.ml_datasets.penguins&quot;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>client.query(sql).to_dataframe()[<span class="st">&#39;COUNT&#39;</span>].tolist()[<span class="dv">0</span>]</span></code></pre></div>
  <p>Or the following for running a query from a private table in our
  project:</p>
  <div class="sourceCode" id="cb9"><pre
  class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># BigQuery from a data that landed in our project</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">&quot;SELECT DISTINCT TOWN AS TOWN FROM BQ_Tutorial.boston_data&quot;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>client.query(sql).to_dataframe().sort_values(by <span class="op">=</span> <span class="st">&#39;TOWN&#39;</span>)</span></code></pre></div>
  <p>Note that <code>FROM</code> clause includes
  <code>&lt;project_name&gt;.&lt;dataset_name&gt;.&lt;table_name&gt;</code>.
  However, <code>project_name</code> can be skipped if the dataset is in
  the current project.</p>
  <p>The results can be written in the project BigQuery tables. For
  instance:</p>
  <div class="sourceCode" id="cb10"><pre
  class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write to BigQuery</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas_gbq</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT * FROM bigquery-public-data.ml_datasets.penguins</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE  body_mass_g &lt; 3500 AND sex = &#39;FEMALE&#39;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> client.query(sql).to_dataframe()</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>df.to_gbq(<span class="st">&#39;BQ_Tutorial.penguins_data&#39;</span>, if_exists <span class="op">=</span> <span class="st">&#39;append&#39;</span>) <span class="co"># Will append if table exists. Other options are &#39;fail&#39; or &#39;replace&#39;</span></span></code></pre></div>
  <p>Also, it is possible to directly read data from our buckets. For
  instance:</p>
  <div class="sourceCode" id="cb11"><pre
  class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data from the project bucket</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>file_path_r <span class="op">=</span> <span class="st">&#39;gs://bucket_read_test/boston_data.csv&#39;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>pd.read_csv(file_path_r, sep <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>)</span></code></pre></div>
  <p>And we can write data to a bucket, such as:</p>
  <div class="sourceCode" id="cb12"><pre
  class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write data to the project bucket</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>file_path_w <span class="op">=</span> <span class="st">&#39;gs://bucket_read_test/penguins_data.csv&#39;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>df.to_csv(file_path_w)</span></code></pre></div>
  <p>Note that the bucket path has this pattern:
  <code>gs://&lt;bucket_name&gt;/&lt;file_name&gt;</code>.</p>
  <h2 id="use-the-gpc-instance-from-a-local-terminal">Use the GPC
  instance from a local terminal</h2>
  <p>We can use GCP resources directly from our computer’s terminal. For
  communicating with GCP resources from terminal, <code>gcloud</code>
  should be installed in your computer. On Linux (WSL),
  <code>gcloud</code> can be installed by:</p>
  <div class="sourceCode" id="cb13"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Gcloud</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main&quot;</span> <span class="kw">|</span> <span class="fu">sudo</span> tee <span class="at">-a</span> /etc/apt/sources.list.d/google-cloud-sdk.list</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> https://packages.cloud.google.com/apt/doc/apt-key.gpg <span class="kw">|</span> <span class="fu">sudo</span> apt-key <span class="at">--keyring</span> /usr/share/keyrings/cloud.google.gpg add <span class="at">-</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install <span class="at">-y</span> google-cloud-cli</span></code></pre></div>
  <p>Now, we can login to the GCP instance and run the workflow. To do
  so, first run:</p>
  <div class="sourceCode" id="cb14"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> auth login <span class="at">--update-adc</span> </span></code></pre></div>
  <p>Then set the project id and the compute region (if you did not
  before):</p>
  <div class="sourceCode" id="cb15"><pre
  class="sourceCode sh"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> config set project <span class="op">&lt;</span>project_id<span class="op">&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> config set compute/region us-central1-a</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> config set compute/zone us-central1-a</span></code></pre></div>
  <p>And finally create a workflow including the following steps: -
  Start a GCP instance - Run the script (e.g., Python) - Store the
  results (e.g., in BigQuery table, a bucket, or local) - Stop the
  instance</p>
  <p>For instance, the following script, called
  <code>verai-job.sh</code>, does the above steps to run a Python script
  and store results in local:</p>
  <div class="sourceCode" id="cb16"><pre
  class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/bash</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Author: Ashkan Mirzaee</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># License: GPL-3.0</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Date: 2023/01/30</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Source: https://github.com/ashki23/HPC-notes</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Instance and bucket names as input</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="va">instance_name</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="va">script_name</span><span class="op">=</span><span class="va">$2</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">## Start instance</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> compute instances start <span class="va">$instance_name</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co">## Transfer the Python script to the GCP instance</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> compute scp <span class="va">$script_name</span> <span class="va">$instance_name</span>:~ <span class="at">--internal-ip</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">## Run the job on GCP</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> compute ssh <span class="va">$instance_name</span> <span class="at">--internal-ip</span> <span class="at">--command</span> <span class="st">&quot;export PATH=</span><span class="dt">\$</span><span class="st">PATH:/opt/conda/bin &amp;&amp; source activate base &amp;&amp; python </span><span class="va">$script_name</span><span class="st">&quot;</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co">## Transfer results to local</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> compute scp <span class="va">$instance_name</span>:~/result.csv . <span class="at">--internal-ip</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co">## Stop the instance</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="ex">gcloud</span> compute instances stop <span class="va">$instance_name</span></span></code></pre></div>
  <p>Where the Python script, called <code>python-job.py</code>, is:</p>
  <div class="sourceCode" id="cb17"><pre
  class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env python</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Author: Ashkan Mirzaee</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># License: GPL-3.0</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Date: 2023/01/30</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Source: https://github.com/ashki23/HPC-notes</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.cloud <span class="im">import</span> bigquery</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> bigquery.Client()</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT * FROM bigquery-public-data.ml_datasets.penguins</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE  body_mass_g &lt; 3500 AND sex = &#39;FEMALE&#39;</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> client.query(sql).to_dataframe()</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">&#39;./result.csv&#39;</span>)</span></code></pre></div>
  <p>Now run the workflow on a Vertex AI workbench by:</p>
  <div class="sourceCode" id="cb18"><pre
  class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> verai-job.sh <span class="op">&lt;</span>workbench_name<span class="op">&gt;</span> <span class="op">&lt;</span>script_name<span class="op">&gt;</span></span></code></pre></div>
  <p>For instance:</p>
  <div class="sourceCode" id="cb19"><pre
  class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> verai-job.sh notebook-test python-job.py</span></code></pre></div>
  <p>After the above job is finished you can find the results (here
  <code>result.csv</code>) in the current directory.</p>
	</div>
      </main>
    </div>
    
    <!-- After body contents -->
        <!-- Footer -->
        <footer class="bd-footer mt-auto py-3 py-md-3 bg-body-tertiary">
          <div class="container py-md-3 px-4 px-md-3 text-body-secondary" align="center" style="font-size: .95rem;">
            Text is available under <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener">CC BY-SA 3.0</a>
            &nbsp;|&nbsp;
            Code licensed under <a href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener">GPL-3.0</a>
            &nbsp;|&nbsp;
            Built with <a href="https://github.com/ashki23/pandoc-bootstrap" target="_blank" rel="noopener">pandoc-bootstrap</a> theme
            <br />
            Copyright 2018-2024, Ashkan Mirzaee
          </div>
        </footer>

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-132464297-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-132464297-1');
        </script>
        
    <!-- Bootstrap Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <!-- Highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js" integrity="sha512-6yoqbrcLAHDWAdQmiRlHG4+m0g/CT/V9AGyxabG8j7Jk8j3r3K6due7oqpiRMZqcYe9WM2gPcaNNxnl2ux+3tA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
        
    <!-- Custom Scripts -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
	  const htmlElement = document.documentElement;
	  const highlightStyle = document.getElementById("highlight-style");
	  
	  // Function to update Highlight.js style based on theme
	  const updateHighlightStyle = (theme) => {
              const lightTheme = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/stackoverflow-light.min.css";
              const darkTheme = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/github-dark.min.css";
              highlightStyle.href = theme === "dark" ? darkTheme : lightTheme;
	  };
	  
	  // Function to set the theme
	  const setTheme = (theme) => {
              htmlElement.setAttribute("data-bs-theme", theme);
              localStorage.setItem("theme", theme); // Save the theme to localStorage
              updateHighlightStyle(theme);
	  };
	  
	  // Get saved theme from localStorage or fallback to default ("light")
	  const savedTheme = localStorage.getItem("theme") || "light";
	  setTheme(savedTheme);
	  
	  // Event listener for theme dropdown
	  document.querySelectorAll(".dropdown-item").forEach((item) => {
              item.addEventListener("click", (e) => {
		  e.preventDefault();
		  const selectedTheme = item.getAttribute("data-theme");
		  setTheme(selectedTheme);
              });
	  });
	  
	  // Initialize Highlight.js
	  hljs.highlightAll();
      });
    </script>
  </body>
</html>

<!doctype html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <meta name="generator" content="pandoc">
      <meta name="author" content="Ashkan Mirzaee">
      <meta name="description" content="Introduction to Venv and Miniconda3">
      <title>Virtual environments in Python</title>
      <!-- Bootstrap -->
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
      <!-- Font-awesome -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
      <!-- Styles -->
      <link rel="stylesheet" href="https://ashki23.github.io/styles.css">
            <!-- Favicon -->
            <link rel="icon" href="images/AM.jpg">
            <!-- Google-site-verification -->
            <meta name="google-site-verification" content="lD_nifpQ-CA6LaDwxYJbe5bq0oa6Ir0Ax-txvtdP51E">
            <!-- Bing-site-verification -->
            <meta name="msvalidate.01" content="89BCD3FF42B6E9FE48E0C8365767D11B">
         </head>
   <body>
            <nav class="navbar fixed-top navbar-expand-lg navbar-dark bd-navbar">
               <a class="navbar-brand" href="index.html">Ashkan Mirzaee</a>
               <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" style="border: none; outline: none; padding-right: 0; padding-left: 1rem;">
               <span class="navbar-toggler-icon"></span>
               </button>
               <div class="collapse navbar-collapse" id="navbarSupportedContent">
                  <ul class="navbar-nav mr-auto">
                     <li class="nav-item">
                        <a class="nav-link" href="page1.html">Blog</a>
                     </li>
                     <li class="nav-item">
                        <a class="nav-link" href="tutorials.html">Tutorials</a>
                     </li>
            	 <li class="nav-item">
                        <a class="nav-link" href="research.html">Research</a>
                     </li>
            	 <li class="nav-item">
                        <a class="nav-link" href="applications.html">Applications</a>
                     </li>
            	 <li class="nav-item">
                        <a class="nav-link" href="blogroll.html">Blogroll</a>
                     </li>
                  </ul>
                  <ul class="navbar-nav ml-auto">
            	<li class="nav-item">
            	  <a class="nav-link" href="contact.html" aria-label="Contact">
            	    <span class="fa fa-envelope fa-lg"></a>
            	</li>
            	<li class="nav-item">
            	  <a class="nav-link" href="https://github.com/ashki23" target="_blank" rel="noopener" aria-label="GitHub">
            	    <span class="fa fa-github fa-lg"></span></a>
            	</li>
            	<li class="nav-item">
            	  <a class="nav-link" href="https://gitlab.com/ashki23" target="_blank" rel="noopener" aria-label="GitLab">
            	    <span class="fa fa-gitlab fa-lg"></span></a>
            	</li>
            	<li class="nav-item">
            	  <a class="nav-link" href="https://www.linkedin.com/in/ashkan-mirzaee/" target="_blank" rel="noopener" aria-label="Linkedin">
            	    <span class="fa fa-linkedin fa-lg"></span></a>
            	</li>
                  </ul>
               </div>
            </nav>
            <div class="container">
         <h1 class="title">Virtual environments in Python</h1>
                  <div class="row">
            <div class="col-xl-10"><p>"Python applications will often use packages and modules that don’t come as part of the standard library. Applications will sometimes need a specific version of a library, because the application may require that a particular bug has been fixed or the application may be written using an obsolete version of the library’s interface.</p>
<p>This means it may not be possible for one Python installation to meet the requirements of every application. If application A needs version 1.0 of a particular module but application B needs version 2.0, then the requirements are in conflict and installing either version 1.0 or 2.0 will leave one application unable to run.</p>
<p>The solution for this problem is to create a virtual environment, a self-contained directory tree that contains a Python installation for a particular version of Python, plus a number of additional packages." - from <a href="https://docs.python.org/3/tutorial/venv.html">the Python Tutorial</a></p>
<p>In this tutorial we will discuss about two major methods to create and manage virtual environments in Python.</p>
<hr />
<h2 id="venv">Venv</h2>
<p>To create a virtual environment, run the venv module as a script with the directory path. For example the following code uses the venv module, <code>-m venv</code>, to create <code>tutorial-env</code> in the current directory:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="ex">python3</span> -m venv tutorial-env</span></code></pre></div>
<p>It also creates directories containing a copy of the Python interpreter, the standard library, and various supporting files. Once we’ve created a virtual environment, we can activate it by:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="bu">source</span> tutorial-env/bin/activate</span></code></pre></div>
<p>After activating the environment with the above command, we can use <code>pip</code> to install required packages by:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="ex">pip</span> install <span class="op">&lt;</span>package1<span class="op">&gt;</span> <span class="op">&lt;</span>package2=version<span class="op">&gt;</span> <span class="op">&lt;</span>package3<span class="op">&gt;</span>=version<span class="op">&gt;</span> ...</span></code></pre></div>
<p>For example, the following Bash script creates <code>tutorial-env</code> if it does not exist, and install <code>redis</code> and <code>gitpython</code> after activation:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="kw">if</span><span class="bu"> [</span> <span class="ot">!</span> <span class="ot">-d</span> tutorial-env<span class="bu"> ]</span>; <span class="kw">then</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="ex">python3</span> -m venv tutorial-env</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="kw">fi</span></span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="bu">source</span> tutorial-env/bin/activate</span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="ex">pip</span> install redis gitpython</span></code></pre></div>
<p>To uninstall packges use:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a><span class="ex">pip</span> unisntall <span class="op">&lt;</span>package1<span class="op">&gt;</span> <span class="op">&lt;</span>package2<span class="op">&gt;</span> ...</span></code></pre></div>
<p>To keep a list of the packages (commonly called <code>requirements.txt</code>) that are installed in the env, use:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a><span class="ex">pip</span> freez <span class="op">&gt;</span> requirements.txt</span></code></pre></div>
<p>To install packages from a <code>requirements.txt</code> file use:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a><span class="ex">pip</span> install -r requirements.txt</span></code></pre></div>
<p>We can use <code>deactivate</code> command to deactivate and env and use <code>rm -rf &lt;env_path&gt;</code> to remove th env.</p>
<hr />
<h2 id="miniconda">Miniconda</h2>
<p>To create virtual environments, <a href="https://conda.io/en/latest/">Conda</a> could be the best environment management system. Miniconda is an open source package and environment management system that includes Conda. Conda quickly installs, runs and updates packages and their dependencies. To start using Conda, follow the instruction in <a href="https://conda.io/projects/conda/en/latest/user-guide/install/index.html">here</a> to install Miniconda (or Anaconda if you want to have most of the scientific packages) on your operating system.</p>
<p>When Miniconda is installed, use <code>conda init &lt;shell-name&gt;</code> to initiate Conda and run <code>conda config --set auto_activate_base false</code> to stop auto base activation. We can also use <code>conda update conda</code> to upate Conda.</p>
<p>For adding Conda autocompletion, in bash terminal copy <a href="https://github.com/tartansandal/conda-bash-completion/blob/master/conda">conda-bash-completion</a> in <code>/usr/share/bash-completion/completions/conda</code>. And for a macOS with zsh, copy <a href="https://github.com/esc/conda-zsh-completion/blob/master/_conda">conda-zsh-completion</a> in <code>~/miniconda3/zsh-completion/_conda</code> and add the following to the <code>~/.zshrc</code> file:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1"></a><span class="va">fpath+=</span><span class="st">&quot;/Users/</span><span class="va">${USER}</span><span class="st">/miniconda3/zsh-completion&quot;</span> <span class="kw">&amp;&amp;</span> <span class="ex">compinit</span></span></code></pre></div>
<h3 id="usage">Usage</h3>
<p>To create a new environment, use <code>conda create</code> command including names of the environment and required packages:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1"></a><span class="ex">conda</span> create --name <span class="op">&lt;</span>env_name<span class="op">&gt;</span> <span class="op">&lt;</span>package1<span class="op">&gt;</span> <span class="op">&lt;</span>package2=version<span class="op">&gt;</span> ...</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co"># or</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="ex">conda</span> create --prefix <span class="op">&lt;</span>env_path<span class="op">&gt;</span> <span class="op">&lt;</span>package1<span class="op">&gt;</span> <span class="op">&lt;</span>package2=version<span class="op">&gt;</span> ...</span></code></pre></div>
<p>We also can use <code>--yes</code> flag to set up the environment without a question. We use <code>--prefix &lt;env_path&gt;</code> to setup the environment in a certain path. Note that we can not use <code>--prefix</code> and <code>--name</code> at the same time.</p>
<p>To see list of environments, use the following:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1"></a><span class="ex">conda</span> env list</span></code></pre></div>
<p>To activate an environment type:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1"></a><span class="ex">conda</span> activate <span class="op">&lt;</span>env_name<span class="op">&gt;</span> or <span class="op">&lt;</span>env_path<span class="op">&gt;</span></span></code></pre></div>
<p>Note that, for Conda versions prior to 4.6 we need to use <code>source</code> instead of <code>conda</code> to activate an env. Now, use the following to install new packages in the activated env:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1"></a><span class="ex">conda</span> install <span class="op">&lt;</span>package1<span class="op">&gt;</span> <span class="op">&lt;</span>package2=version<span class="op">&gt;</span> ...</span></code></pre></div>
<p>To uninstall packages use:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1"></a><span class="ex">conda</span> uninstall <span class="op">&lt;</span>package1<span class="op">&gt;</span> <span class="op">&lt;</span>package2=version<span class="op">&gt;</span> ...</span></code></pre></div>
<p>To see list of the installed packages within the env, use:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1"></a><span class="ex">conda</span> list</span></code></pre></div>
<p>To keep a list of the packages (commonly called <code>requirements.txt</code>) that are installed in the env, use:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1"></a><span class="ex">conda</span> list --export <span class="op">&gt;</span> requirements.txt</span></code></pre></div>
<p>We can deactivate the env by:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1"></a><span class="ex">conda</span> deactivate</span></code></pre></div>
<p>And remove the deactivated virtual environment by:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1"></a><span class="ex">conda</span> env remove --name <span class="op">&lt;</span>env_name<span class="op">&gt;</span> or --prefix <span class="op">&lt;</span>env_path<span class="op">&gt;</span></span></code></pre></div>
<p>To remove cache files we can use:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1"></a><span class="ex">conda</span> clean --all</span></code></pre></div>
<p>We can regenerate an env from a <code>requirements.txt</code> file:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1"></a><span class="ex">conda</span> create --name <span class="op">&lt;</span>env_name<span class="op">&gt;</span> --file requirments.txt</span></code></pre></div>
<p>Note that there is a short form for most of the Conda options that can be used instead of the long form. For instance, <code>-n</code>, <code>-p</code>, <code>-c</code>, <code>-y</code>, and <code>-e</code> can be used instead of <code>--name</code>, <code>--prefix</code>, <code>--channel</code>, <code>--yes</code>, and <code>--export</code>, respecively. You may find more information by using <code>conda -h</code> or <code>conda &lt;command&gt; -h</code>.</p>
<h3 id="conda-channels">Conda channels</h3>
<p>Whenever we use <code>conda create</code> or <code>conda install</code> without mentioning a channel name, Conda package manager search its default channels to install the packages. If you are looking for specific packages that are not in the default channels you have to mention them by using:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1"></a><span class="ex">codna</span> create --name <span class="op">&lt;</span>env_name<span class="op">&gt;</span> --channel <span class="op">&lt;</span>channel1<span class="op">&gt;</span> --channel <span class="op">&lt;</span>channel2<span class="op">&gt;</span> ... <span class="op">&lt;</span>package1<span class="op">&gt;</span> <span class="op">&lt;</span>package2<span class="op">&gt;</span> ...</span></code></pre></div>
<p>For example the following creates <code>new_env</code> and installs r-sf, shapely and bioconductor-biobase from <code>r</code>, <code>conda-forge</code> and <code>bioconda</code> channels:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1"></a><span class="ex">codna</span> create --name new_env --channel r --channel conda-forge --channel bioconda r-sf shapely bioconductor-biobase</span></code></pre></div>
<p>Ideally, you should create one environment per project and include all the required packages when you create the environment and try to use a single channel as much as possible. It is important using the same channels for updating the environment.</p>
<h3 id="conda-packages">Conda packages</h3>
<p>To find the required packages, we can visit <a href="https://anaconda.org">anaconda.org</a> and search for packages to find their full name and the corresponding channel. Another option is using <code>conda search</code> command. Note that we need to search the right channel to find pakages that are not in the default channels. For example:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1"></a><span class="ex">conda</span> search --channel bioconda biobase</span></code></pre></div>
<h3 id="hpc-workflow">HPC workflow</h3>
<p>In a HPC cluster system, first we need to load <code>miniconda3</code> module to be able to use <code>conda</code>. We can use the following as a template for building a new environment:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1"></a><span class="ex">module</span> load miniconda3</span>
<span id="cb23-2"><a href="#cb23-2"></a></span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="kw">if</span><span class="bu"> [</span> <span class="ot">!</span> <span class="ot">-d</span> &lt;env_path<span class="ot">&gt;</span><span class="bu"> ]</span>; <span class="kw">then</span></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="ex">conda</span> create --yes --prefix <span class="op">&lt;</span>env_path<span class="op">&gt;</span> <span class="op">&lt;</span>package1<span class="op">&gt;</span> <span class="op">&lt;</span>package2<span class="op">&gt;</span> ...</span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="kw">fi</span></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="bu">source</span> activate <span class="op">&lt;</span>env_path<span class="op">&gt;</span></span></code></pre></div>
<p>To keep Conda packages and caches somewhere except the home directory, we can update conda pathes by exporting new <code>CONDA_PKGS_DIRS</code> and <code>CONDA_ENVS_DIRS</code> or creating/updating <code>~/.condarc</code> file. Review <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/configuration/use-condarc.html#specify-environment-directories-envs-dirs">here</a> to learn more.</p></div>
            <div class="d-none d-xl-block col-xl-2 bd-toc">
               <ul class="section-nav">
                  <li class="toc-entry"><ul>
<li><a href="#venv">Venv</a></li>
<li><a href="#miniconda">Miniconda</a>
<ul>
<li><a href="#usage">Usage</a></li>
<li><a href="#conda-channels">Conda channels</a></li>
<li><a href="#conda-packages">Conda packages</a></li>
<li><a href="#hpc-workflow">HPC workflow</a></li>
</ul></li>
</ul></li>
               </ul>
            </div>
         </div>
               </div>
            <!-- Footer -->
            <footer class="footer text-muted">
               <div align="center">
                  Text is available under <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener">CC BY-SA 3.0</a>
                  &nbsp;|&nbsp;
                  Code licensed under <a href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener">GPL-3.0</a>
                  &nbsp;|&nbsp;
                  Built with <a href="https://github.com/ashki23/pandoc-bootstrap" target="_blank" rel="noopener">pandoc-bootstrap</a> theme
                  <br />
                  Copyright 2018-2021, Ashkan Mirzaee
               </div>
            </footer>
            <!-- Global site tag (gtag.js) - Google Analytics -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=UA-132464297-1"></script>
            <script>
               window.dataLayer = window.dataLayer || [];
               function gtag(){dataLayer.push(arguments);}
               gtag('js', new Date());
               gtag('config', 'UA-132464297-1');
            </script>
            <!-- JS, Popper.js, and jQuery -->
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
      <!-- Mathjax -->
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script>
         /* Bootstrap styles to tables */
         function bootstrapStylePandocTables() {
         $('tr.header').parent('thead').parent('table').addClass('table table-condensed'); }
         $(document).ready(function () { bootstrapStylePandocTables(); });
         /* Adjust the height when click the toc */
         var shiftWindow = function() { scrollBy(0, -60) };
         window.addEventListener("hashchange", shiftWindow);
         function load() { if (window.location.hash) shiftWindow(); }
      </script>
   </body>
</html>
